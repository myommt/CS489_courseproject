<!DOCTYPE html>
<html lang="en" xmlns:th="https://thymeleaf.org">

<head th:replace="~{fragments/head-elements :: headElements}">
    <title>Dental Surgery - Add New Patient</title>
</head>

<body>
    <div id="page-content">
        <header th:replace="~{fragments/header :: header}"></header>
        <main class="container mt-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="text-primary">
                    <i class="fas fa-user-plus"></i> Add New Patient
                </h1>
                <div>
                    <a href="/secured/patient/list" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Patient List
                    </a>
                </div>
            </div>

            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-user-plus"></i> Patient Information</h5>
                        </div>
                        <div class="card-body">
                            <form id="patientForm" th:action="@{/secured/patient/new}" th:object="${patient}"
                                method="post" th:classappend="${#fields.hasErrors('*')} ? 'was-validated' : ''"
                                novalidate>
                                <!-- Server-side validation summary (needs th:object context) -->
                                <div class="alert alert-danger d-flex align-items-center" role="alert"
                                    th:if="${#fields.hasErrors('*')}">
                                    <i class="fas fa-circle-exclamation me-2"></i>
                                    <div>
                                        Please fix the following errors:
                                        <ul class="mb-0 mt-1">
                                            <li th:each="err : ${#fields.errors('*')}" th:text="${err}">Error</li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- Personal Information -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="firstName" class="form-label">
                                            <i class="fas fa-user"></i> First Name <span class="required">*</span>
                                        </label>
                                        <input type="text" class="form-control" th:field="*{firstName}" id="firstName"
                                            th:classappend="${#fields.hasErrors('firstName')} ? ' is-invalid' : ''"
                                            aria-describedby="firstNameFeedback" required>
                                        <div id="firstNameFeedback" class="invalid-feedback">
                                            <span th:if="${#fields.hasErrors('firstName')}"
                                                th:errors="*{firstName}">First name is required</span>
                                            <span th:unless="${#fields.hasErrors('firstName')}">First name is
                                                required</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="lastName" class="form-label">
                                            <i class="fas fa-user"></i> Last Name <span class="required">*</span>
                                        </label>
                                        <input type="text" class="form-control" th:field="*{lastName}" id="lastName"
                                            th:classappend="${#fields.hasErrors('lastName')} ? ' is-invalid' : ''"
                                            aria-describedby="lastNameFeedback" required>
                                        <div id="lastNameFeedback" class="invalid-feedback">
                                            <span th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}">Last
                                                name is required</span>
                                            <span th:unless="${#fields.hasErrors('lastName')}">Last name is
                                                required</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="dob" class="form-label">
                                            <i class="fas fa-calendar"></i> Date of Birth <span
                                                class="required">*</span>
                                        </label>
                                        <input type="date" class="form-control" th:field="*{dob}" id="dob"
                                            th:classappend="${#fields.hasErrors('dob')} ? ' is-invalid' : ''"
                                            aria-describedby="dobFeedback" required>
                                        <div id="dobFeedback" class="invalid-feedback">
                                            <span th:if="${#fields.hasErrors('dob')}" th:errors="*{dob}">Date of birth
                                                is required</span>
                                            <span th:unless="${#fields.hasErrors('dob')}">Date of birth is
                                                required</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6"></div>
                                </div>

                                <!-- Contact Information -->
                                <hr>
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-phone"></i> Contact Information
                                </h6>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="contactNumber" class="form-label">
                                            <i class="fas fa-phone"></i> Phone Number
                                        </label>
                                        <input type="tel" class="form-control" th:field="*{contactNumber}"
                                            id="contactNumber" placeholder="(xxx) xxx-xxxx">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">
                                            <i class="fas fa-envelope"></i> Email Address
                                        </label>
                                        <input type="email" class="form-control" th:field="*{email}" id="email"
                                            placeholder="patient@example.com">
                                    </div>
                                </div>

                                <!-- Address Information -->
                                <hr>
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-home"></i> Address Information
                                </h6>

                                <div class="mb-3">
                                    <label for="addressStreet" class="form-label">
                                        <i class="fas fa-road"></i> Street Address <span class="required">*</span>
                                    </label>
                                    <input type="text" class="form-control" th:field="*{address.street}"
                                        id="addressStreet" placeholder="123 Main Street" required>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="addressCity" class="form-label">
                                            <i class="fas fa-city"></i> City <span class="required">*</span>
                                        </label>
                                        <input type="text" class="form-control" th:field="*{address.city}"
                                            id="addressCity" placeholder="City" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="addressState" class="form-label">
                                            <i class="fas fa-map"></i> State <span class="required">*</span>
                                        </label>
                                        <input type="text" class="form-control" th:field="*{address.state}"
                                            id="addressState" placeholder="State" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="addressZipcode" class="form-label">
                                            <i class="fas fa-mail-bulk"></i> ZIP Code <span class="required">*</span>
                                        </label>
                                        <input type="text" class="form-control" th:field="*{address.zipcode}"
                                            id="addressZipcode" placeholder="12345" required>
                                    </div>
                                </div>

                                <!-- Medical Information -->
                                <hr>
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-notes-medical"></i> Medical Information
                                </h6>

                                <div class="mb-3">
                                    <label for="medicalHistory" class="form-label">
                                        <i class="fas fa-file-medical"></i> Medical History / Notes
                                    </label>
                                    <textarea class="form-control" id="medicalHistory" rows="4"
                                        placeholder="Any relevant medical history, allergies, or notes..."></textarea>
                                </div>

                                <!-- Form Actions -->
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-secondary" onclick="history.back()">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                    <div>
                                        <button type="reset" class="btn btn-outline-secondary me-2">
                                            <i class="fas fa-redo"></i> Reset Form
                                        </button>
                                        <button type="submit" class="btn btn-success">
                                            <i class="fas fa-save"></i> Save Patient
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Quick Actions Card -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-lightning-bolt"></i> Quick Actions</h6>
                        </div>
                        <div class="card-body">
                            <div class="d-flex gap-2 flex-wrap">
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="fillSampleData()">
                                    <i class="fas fa-magic"></i> Fill Sample Data
                                </button>
                                <button type="button" class="btn btn-outline-info btn-sm" onclick="validateForm()">
                                    <i class="fas fa-check"></i> Validate Form
                                </button>
                                <a href="/secured/patient/list" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-list"></i> View All Patients
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer th:replace="~{fragments/footer :: footer}"></footer>
    </div>

    <script>
        function fillSampleData() {
            document.getElementById('firstName').value = 'John';
            document.getElementById('lastName').value = 'Doe';
            document.getElementById('dob').value = '1990-01-15';
            document.getElementById('contactNumber').value = '(555) 123-4567';
            document.getElementById('email').value = 'john.doe@example.com';
            document.getElementById('addressStreet').value = '123 Main Street';
            document.getElementById('addressCity').value = 'Healthcare City';
            document.getElementById('addressState').value = 'HC';
            document.getElementById('addressZipcode').value = '12345';
            document.getElementById('medicalHistory').value = 'No known allergies. Regular dental checkups.';
        }

        function validateForm() {
            const form = document.querySelector('form');
            if (!form) return;
            if (form.checkValidity()) {
                // Optionally show a toast; avoid blocking alerts
                console.log('Form is valid and ready to submit!');
            } else {
                form.classList.add('was-validated');
                form.reportValidity();
            }
        }

        // Add Bootstrap validation styling on submit
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('patientForm');
            if (!form) return;
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });

        // Auto-format phone number
        document.getElementById('contactNumber').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 6) {
                value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
            } else if (value.length >= 3) {
                value = value.replace(/(\d{3})(\d{0,3})/, '($1) $2');
            }
            e.target.value = value;
        });
    </script>

    <style>
        .form-label {
            font-weight: 600;
        }

        .required {
            color: red;
        }

        .card {
            border-radius: 10px;
        }

        .card-header {
            border-radius: 10px 10px 0 0 !important;
        }
    </style>
</body>

</html>